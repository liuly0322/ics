var be=Object.defineProperty;var Fe=(a,t,e)=>t in a?be(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var Z=(a,t,e)=>(Fe(a,typeof t!="symbol"?t+"":t,e),e);import{d as defineComponent,r as ref,b as computed,w as watch,o as openBlock,c as createElementBlock,e as createBaseVNode,f as withDirectives,v as vModelText,F as Fragment,g as renderList,u as unref,t as toDisplayString,h as vShow,i as createVNode,j as withCtx,k as createCommentVNode,n as nextTick,l as resolveComponent,m as vModelRadio,p as createTextVNode,a as createStaticVNode}from"./app.a3e8a1a4.js";const labs={lab1:{testCode:"",ansCode:"",testCases:"",description:"\u522B\u6025\uFF0C\u7B49 lab1 \u51FA..."},\u81EA\u5B9A\u4E49:{testCode:"",ansCode:"",testCases:"",description:"\u81EA\u5B9A\u4E49\u6D4B\u8BD5\u6837\u4F8B"}},presets=Object.keys(labs);function getPreset(a){return labs[a]}const as=function(){Array.prototype.includes||(Array.prototype.includes=function(s){var n=Object(this),u=parseInt(n.length)||0;if(u===0)return!1;var d=parseInt(arguments[1])||0,i;d>=0?i=d:(i=u+d,i<0&&(i=0));for(var f;i<u;){if(f=n[i],s===f||s!==s&&f!==f)return!0;i++}return!1}),String.prototype.includes||(String.prototype.includes=function(){return typeof arguments[1]=="number"?this.length<arguments[0].length+arguments[1].length?!1:this.substr(arguments[1],arguments[0].length)===arguments[0]:String.prototype.indexOf.apply(this,arguments)!==-1});var a=function(){function s(n,u){var d=[],i=!0,f=!1,p=void 0;try{for(var v=n[Symbol.iterator](),x;!(i=(x=v.next()).done)&&(d.push(x.value),!(u&&d.length===u));i=!0);}catch(c){f=!0,p=c}finally{try{!i&&v.return&&v.return()}finally{if(f)throw p}}return d}return function(n,u){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return s(n,u);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=Object.assign||function(s){for(var n=1;n<arguments.length;n++){var u=arguments[n];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(s[d]=u[d])}return s};function e(s){if(Array.isArray(s)){for(var n=0,u=Array(s.length);n<s.length;n++)u[n]=s[n];return u}else return Array.from(s)}function r(s){return Array.isArray(s)?s:Array.from(s)}function o(s,n,u){return n in s?Object.defineProperty(s,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[n]=u,s}function l(s){var n=arguments.length<=1||arguments[1]===void 0?function(u){return u}:arguments[1];return function(){try{return{success:!0,result:s.apply(void 0,arguments)}}catch(u){return{success:!1,errorMessage:n(u.message)}}}}function h(s,n){return function(){try{return s.apply(void 0,arguments)}catch(u){throw new Error(n+": "+u.message)}}}var y=65536,C=16,F=65024,b={MEMORY_SIZE:y,WORD_BITS:C,MAX_STANDARD_MEMORY:F};function B(s){if(s=s.toLowerCase(),s.length===0)return NaN;var n=!1;switch(s[0]==="-"&&(s=s.slice(1),n=!0),s[0]){case"x":var u=s.slice(1);if(u.match(/[^0-9a-f]/))return NaN;var i=parseInt(u,16);return n?-i:i;case"b":var d=s.slice(1);if(d.match(/[^01]/))return NaN;var i=parseInt(d,2);return n?-i:i;default:if(s.match(/[^0-9]/))return NaN;var i=parseInt(s);return n?-i:i}}function _(s){var n=arguments.length<=1||arguments[1]===void 0?4:arguments[1],u=arguments.length<=2||arguments[2]===void 0?"x":arguments[2],d=s.toString(16).toUpperCase();return d.length<n&&(d=Array(n-d.length+1).join("0")+d),u+d}function g(s){return s=s%(1<<C)&(1<<C)-1,s&1<<C-1?s-(1<<C):s}function V(s){var n=g(s);return n<0?n+(1<<C):n}function oe(s,n){var u=s&1<<n-1;return g(u?s-(1<<n):s&(1<<n)-1)}function se(s){var n=s&4,u=s&2,d=s&1;return!!n+!!u+!!d!=1?null:n?-1:d?1:0}function le(s){switch(se(s)){case null:return"Invalid";case-1:return"N";case 0:return"Z";case 1:return"P"}}var w={parseNumber:B,toHexString:_,toInt16:g,toUint16:V,signExtend16:oe,getConditionCode:se,formatConditionCode:le};function ce(s){var n=l(function(){var u=fe(s),d=pe(u),i=d.orig,f=d.begin,p=xe(u,i,f),v=p.symbolTable,x=Ce(u,v,i,f);return{orig:i,symbolTable:v,machineCode:x}})(s);return n.success?n.result:{error:[n.errorMessage]}}function L(s){var n=s.match(/^[Rr]([0-7])$/);if(n)return parseInt(n[1]);throw new Error("Invalid register specification: '"+s+"'")}function I(s){var n=new Error("Invalid numeric literal: '"+s+"'"),u=s.charAt(0);if(u!=="#"&&u.toLowerCase()!=="x"&&u.toLowerCase()!=="b")throw n;var d=u==="#",i=s.charAt(1)==="-",f=d?s.substring(i?2:1):i?u+s.substring(2):s,p=w.parseNumber(f);if(isNaN(p)||i&&p<0)throw n;return i?-p:p}function de(s){var n=function(m){throw new Error("while parsing the string "+s+": "+m)};s.length<2&&n("this string is way too short! You need at least two characters just for the quote marks.");var u='"';(s.charAt(0)!==u||s.charAt(s.length-1)!==u)&&n("the string needs to start and end with "+("double quotation marks (e.g.: "+u+"I'm a string"+u+")."));var d=new Array(s.length-2),i=void 0;for(i=1;i<s.length-1;i++){var f=s.charAt(i),p=function(m){return n("at index "+i+": "+m)};if(f==='"'&&p("unescaped double quote found before end of string"),f==="\\"){var v=s.charAt(++i),x={0:"\0",n:`
`,r:"\r",'"':'"',"\\":"\\"}[v];v===void 0&&p("unsupported escape character '"+v+"'"),d[i]=x}else d[i]=f}return(i>=s.length||s.charAt(i)!=='"')&&n("unterminated string literal! Did you accidentally backslash-escape the closing quote?"),d.join("")}function fe(s){return s.split(/\r?\n/).map(he)}function he(s,n){for(var u=s.trimLeft(),d=h(de,"on line "+(n+1)),i=0,f=1,p=2,v=i,x=[],c="",m=0;m<s.length;m++){var E=u.charAt(m),A=!!E.match(/\s/),D=E===",",S=E==='"';if(v===i){if(A||D)continue;v=S?p:f}if(E===";"&&v!==p)break;v===f?A||D?(x.push(c),v=i,c=""):c+=E:v===p&&(c+=E,E==="\\"?c+=u.charAt(++m):S&&c.length>1&&(x.push(d(c)),v=i,c=""))}return c.length>0&&(v===f?x.push(c):v===p&&x.push(d(c))),x}function pe(s){var n=s.findIndex(function(v){return v.length>0});if(n===-1)throw new Error("Looks like your program's empty! You need at least an .ORIG directive and an .END directive.");var u=s[n],d=u.some(function(v){return v.toUpperCase()===".ORIG"});if(!d)throw new Error("The first non-empty, non-comment line of your program needs to have an .ORIG directive!");if(u[0].toUpperCase()!==".ORIG")throw new Error(".ORIG directive cannot have a label!");var i=u.length-1;if(i!==1)throw new Error("The .ORIG directive expects exactly one operand, "+("but it looks like you have "+i+"!"));var f=u[1],p=h(I,"while parsing .ORIG directive operand")(f);if(p!==w.toUint16(p))throw new Error(".ORIG operand ("+f+") is out of range! It should be between 0 and 0xFFFF, inclusive.");return{orig:p,begin:n+1}}function ve(s){if(s.match(/[^A-Za-z0-9_]/))return!1;var n=l(I)(s);return!n.success}function ne(s,n){switch(s.toUpperCase()){case".FILL":return 1;case".BLKW":if(n<0)throw new Error("a .BLKW needs to have a non-negative length, "+("but I found "+n));return n;case".STRINGZ":return n.length+1;default:return 1}}function xe(s,n,u){var d={symbols:{},address:n,seenEndDirective:!1},i=function(c){var m=b.MEMORY_SIZE;if(c>m)throw new Error("currently at address "+w.toHexString(c)+", which is past the memory limit "+("of "+w.toHexString(m)))},f=function(c,m){var E=c.address+m;return i(E),t({},c,{address:E})},p={handleEnd:function(c){return t({},c,{seenEndDirective:!0})},handleLabel:function(c,m){i(c.address+1);var E=m[0],A=c.symbols[E];if(A!==void 0)throw new Error("label name "+E+" already exists; "+("it points to "+w.toHexString(A)));return t({},c,{symbols:t({},c.symbols,o({},E,c.address))})},handleDirective:function(c,m){if(c.seenEndDirective)return c;var E=r(m),A=E[0],D=E.slice(1),S=function(){var k=function(){if(D.length!==1)throw new Error("expected "+A+" directive to have exactly one operand, "+("but found "+D.length))};switch(A.toUpperCase()){case".BLKW":case".FILL":return k(),I(D[0]);case".STRINGZ":return k(),D[0];default:return null}}();return f(c,ne(A,S))},handleInstruction:function(c,m){return c.seenEndDirective?c:f(c,ne(m[0],null))}},v=ae(s,u,p,d);if(!v.seenEndDirective)throw new Error("no .END directive found!");return{symbolTable:v.symbols,programLength:v.address-n}}function me(s,n,u,d){var i=function(x){var c=-(1<<d-1),m=(1<<d-1)-1;if(!(c<=x&&x<=m))throw new Error("offset "+x+" is out of range; "+("it must fit into "+d+" bits, ")+("so it should be between "+c+" and "+m+", inclusive"));return x},f=l(I)(n);if(f.success)return i(f.result);if(!(n in u))throw new Error("the offset '"+n+"' is not a valid numeric literal, but I can't find it in the symbol table either; did you misspell a label name?");var p=u[n];return i(p-s)}function ge(s){var n=s[0],u=s[1];switch(n.toUpperCase()){case".FILL":return[w.toUint16(I(u))];case".BLKW":return new Array(w.toUint16(I(u))).fill(0);case".STRINGZ":return u.split("").map(function(d){return d.charCodeAt(0)}).concat([0]);default:throw new Error("unrecognized directive: "+n)}}function ye(s,n,u){var d=s[0],i=d.toUpperCase(),f=s.slice(1),p=function(R){if(f.length!==R){var N=R===1?"operand":"operands";throw new Error("expected "+d+" instruction to have "+("exactly "+R+" "+N+", but found "+f.length))}},v=function(R,N,re){var q=-(1<<N-1),ue=(1<<N-1)-1;if(q<=R&&R<=ue)return w.toUint16(R)&(1<<N)-1;throw new Error(re+" is out of range: "+("expected value to fit in "+N+" bits ")+("(i.e., to be between "+q+" and "+ue+", inclusive), ")+("but found "+R))},x=function(R,N){var re="while parsing the offset for a "+d,q=h(me,re)(n,R,u,N);return w.toUint16(q)&(1<<N)-1},c={GETC:32,OUT:33,PUTS:34,IN:35,PUTSP:36,HALT:37},m=c[i];if(m!==void 0)return p(0),[61440|m];var E={ADD:1,AND:5,NOT:9,BR:0,BRP:0,BRZ:0,BRZP:0,BRN:0,BRNP:0,BRNZ:0,BRNZP:0,JMP:12,RET:12,JSR:4,JSRR:4,LD:2,LDI:10,LDR:6,LEA:14,RTI:8,ST:3,STI:11,STR:7,TRAP:15},A=E[i];if(A===void 0)throw new Error('unrecognized instruction "'+d+'"');var D=A<<12;if(i==="ADD"||i==="AND"){p(3);var S=f.slice(0,2).map(function(G){return L(G)}),k=a(S,2),P=k[0],W=k[1],O=f[2],T=l(I)(O),z=T.success?32|v(T.result,5,"immediate field"):0|L(O);return[D|P<<9|W<<6|z]}else if(A===0){p(1);var K=i==="BR"?[!0,!0,!0]:["N","Z","P"].map(function(G){return i.substring(2).includes(G)}),U=a(K,3),j=U[0],H=U[1],J=U[2],$=j<<2|H<<1|J<<0,M=x(f[0],9);return[D|$<<9|M]}else{if(i==="JMP")return p(1),[D|L(f[0])<<6];if(i==="RET")return p(0),[D|7<<6];if(i==="JSR")return p(1),[D|1<<11|x(f[0],11)];if(i==="JSRR")return p(1),[D|0<<11|L(f[0])<<6];if(["LD","LDI","LEA","ST","STI"].includes(i)){p(2);var Q=L(f[0]),M=x(f[1],9);return[D|Q<<9|M]}else if(i==="LDR"||i==="STR"){p(3);var ie=L(f[0]),X=L(f[1]),M=x(f[2],6);return[D|ie<<9|X<<6|M]}else if(i==="NOT"){p(2);var P=L(f[0]),ee=L(f[1]);return[D|P<<9|ee<<6|63]}else{if(i==="RTI")return p(0),[D];if(i==="TRAP"){p(1);var te="while parsing the trap vector",Y=h(I,te)(f[0]);if(!(0<=Y&&Y<=255))throw new Error("trap vector out of range: expected value to be an unsigned byte (i.e., between 0 and 255, inclusive), "+("but found "+Y));return[D|Y]}else throw new Error("internal error: unhandled instruction "+d)}}}function Ce(s,n,u,d){var i={machineCode:[],address:u,seenEndDirective:!1},f=function(c,m){return t({},c,{machineCode:c.machineCode.concat(m),address:c.address+m.length})},p={handleDirective:function(c,m){return c.seenEndDirective?c:f(c,ge(m))},handleInstruction:function(c,m){if(c.seenEndDirective)return c;var E=c.address+1;return f(c,ye(m,E,n))},handleEnd:function(c){return t({},c,{seenEndDirective:!0})}},v=ae(s,d,p,i);if(!v.seenEndDirective)throw new Error("missing .END directive");return v.machineCode}function ae(s,n,u,d){var i=function(T){return T},f=u.handleLabel,p=f===void 0?i:f,v=u.handleDirective,x=v===void 0?i:v,c=u.handleInstruction,m=c===void 0?i:c,E=u.handleEnd,A=E===void 0?i:E,D="GETC OUT PUTS IN PUTSP HALT".split(" "),S=["ADD","AND","NOT","BR","BRP","BRZ","BRZP","BRN","BRNP","BRNZ","BRNZP","JMP","RET","JSR","JSRR","LD","LDI","LDR","LEA","RTI","ST","STI","STR","TRAP"],k=[".FILL",".BLKW",".STRINGZ"],P=[].concat(e(D),S,k),W=s.slice(n);return W.reduce(function(O,T,z){if(T.length===0)return O;var K="at line "+(z+n+1),U=function(X){var ee=arguments.length<=1||arguments[1]===void 0?O:arguments[1],te=arguments.length<=2||arguments[2]===void 0?T:arguments[2];return h(X,K)(ee,te,z)},j=T[0];if(j.toUpperCase()===".END")return U(A);var H=!P.includes(j.toUpperCase());if(H&&!ve(j))throw new Error(K+": this line looks like a label, "+("but '"+j+"' is not a valid label name; ")+"you either misspelled an instruction or entered an invalid name for a label");var J=H?U(p):O,$=T.slice(H?1:0);if($.length===0)return J;var M=$[0].toUpperCase(),Q=M.charAt(0)===".";return O.address+1,U(Q?x:m,J,$)},d)}return ce}(),hexbin=function(){var a=function(r){return(r||"").split(`
`).map(function(o){return o.split(";")[0]}).join(`
`)},t=function(r){for(var o=r.split(`
`),l=0;l<o.length;l++){var h=o[l],y=h.match(/[^\s0-9A-Fa-f]/);if(!!y){var C=y[0],F="Invalid character '"+C+"' at line "+(l+1);return{error:F}}}var b=r.replace(/\s/g,""),B=!!b.match(/[^01]/),_=B?4:16;if(b.length%_!==0){var g=b.length===1?"character":"characters",V=B?"hexadecimal":"binary",F="Found a total of "+b.length+" "+g+", but expected to find a multiple of "+_+" for "+V+" data.";return{error:F}}return{type:B?"hex":"binary"}},e=function(r,o){var l=r.replace(/\s/g,""),h=o==="hex"?4:16,y=new Array(l.length/h);if(y.length===0){var C="Your raw data is empty! You need to at least have an origin (.ORIG) address.";return{error:C}}for(var F=0;F<y.length;F++){var b=h*F;y[F]=l.substr(b,h)}var B=o==="hex"?16:2,_=y.map(function(g){return parseInt(g,B)});return{orig:_[0],machineCode:_.slice(1)}};return function(r){var o=a(r),l=t(o);if(l.error)return l;var h=l.type;return e(o,h)}}();function Queue(){var a=[],t=0;this.getLength=function(){return a.length-t},this.isEmpty=function(){return a.length==0},this.enqueue=function(e){a.push(e)},this.dequeue=function(){if(a.length!=0){var e=a[t];return 2*++t>=a.length&&(a=a.slice(t),t=0),e}},this.peek=function(){return 0<a.length?a[t]:void 0}}const lc3osSymbols={TRAP_GETC:1024,TRAP_OUT:1072,TRAP_PUTS:1104,TRAP_IN:1184,TRAP_PUTSP:1248,TRAP_HALT:64880},lc3os={32:1024,33:1072,34:1104,35:1184,36:1248,37:64880,1024:15879,1025:40964,1026:2046,1027:40963,1028:11779,1029:49600,1030:65024,1031:65026,1072:15882,1073:12808,1074:41477,1075:2046,1076:45060,1077:8708,1078:11780,1079:49600,1080:65028,1081:65030,1104:15894,1105:12306,1106:12818,1107:13330,1108:25088,1109:1029,1110:41993,1111:2046,1112:45576,1113:4129,1114:4089,1115:8200,1116:8712,1117:9224,1118:11784,1119:49600,1120:65028,1121:65030,1122:62461,1123:62462,1184:15878,1185:57350,1186:61474,1187:61472,1188:61473,1189:11777,1190:49600,1191:12289,1248:15911,1249:12322,1250:12834,1251:13346,1252:13858,1253:4640,1254:24640,1255:1030,1256:18445,1257:9240,1258:20482,1259:1026,1260:4705,1261:4088,1262:8212,1263:18438,1264:8211,1265:8723,1266:9235,1267:9747,1268:11795,1269:49600,1270:15878,1271:42503,1272:2049,1273:4092,1274:45059,1275:11777,1276:49600,1278:65030,1279:65028,1280:62461,1281:62462,1282:65280,64768:15934,64769:12348,64770:8199,64771:61473,64772:57350,64773:61474,64774:61477,64775:8246,64776:11830,64777:49600,64880:15886,64881:12812,64882:12298,64883:57356,64884:61474,64885:41519,64886:8239,64887:20544,64888:45100,64889:8195,64890:8707,64891:11779,64892:49600,64933:65534,64934:32767,65028:32768,65534:65535},LC3Util={parseNumber:function(a){if(a=a.toLowerCase(),a.length==0)return NaN;var t=!1;switch(a[0]==="-"&&(a=a.slice(1),t=!0),a[0]){case"x":var e=a.slice(1);if(e.match(/[^0-9a-f]/))return NaN;var o=parseInt(e,16);return t?-o:o;case"b":var r=a.slice(1);if(r.match(/[^01]/))return NaN;var o=parseInt(r,2);return t?-o:o;default:if(a.match(/[^0-9]/))return NaN;var o=parseInt(a);return t?-o:o}},toHexString:function(a,t){var e=a.toString(16).toUpperCase();return t=t||4,e.length<t&&(e=Array(t-e.length+1).join("0")+e),"x"+e},toInt16:function(a){return a=a%65536&65535,a&32768?a-65536:a},toUint16:function(a){var t=this.toInt16(a);return t<0?t+65536:t},signExtend16:function(a,t){var e=a>>t-1&1;if(e===1)for(var r=t;r<16;r++)a|=1<<r;else a&=(1<<t)-1;return this.toInt16(a)}};class core{constructor(){this.totalInstruction=0,this.memory=new Array(65536);for(var t=0;t<this.memory.length;t++){var e=lc3os[t];this.memory[t]=e===void 0?0:e}this.listeners=[],this.addListener=function(l){this.listeners.push(l)},this.notifyListeners=function(l){for(var h=0;h<this.listeners.length;h++)this.listeners[h](l)},this.r=new Array(8),this.specialRegisters=["pc","ir","psr"],this.resetAllRegisters(),this.labelToAddress={},this.addressToLabel={};for(var r in lc3osSymbols){var o=lc3osSymbols[r];this.setLabel(o,r)}this.maxStandardMemory=65024,this.kbsr=65024,this.kbdr=65026,this.dsr=65028,this.ddr=65030,this.mcr=65534,this.ioLocations=[this.kbsr,this.kbdr,this.dsr,this.ddr],this.kbiv=384,this.div=385,this.kbpl=2,this.dpl=1,this.namedTrapVectors={32:"GETC",33:"OUT",34:"PUTS",35:"IN",36:"PUTSP",37:"HALT"},this.bufferedKeys=new Queue,this.subroutineLevel=0}formatAddress(t){var e=this.addressToLabel[t];return e!==void 0?e:LC3Util.toHexString(t)}getConditionCode(){var t=(this.psr&4)!==0,e=(this.psr&2)!==0,r=(this.psr&1)!==0;if(t^e^r&&!(t&&e&&r))return t?-1:e?0:1}setConditionCode(t){t=LC3Util.toInt16(t);var e=t<0,r=t>0,o=!e&&!r,l=(e?4:0)|(o?2:0)|(r?1:0);this.setRegister("psr",this.psr&65528|l)}nextInstruction(){this.totalInstruction+=1,this.fetch();var t=this.decode(this.ir),e=this.evaluateAddress(this.pc,t),r=this.fetchOperands(e),o=this.execute(t,e,r);return this.storeResult(t,o),t}fetch(){this.ir=this.getMemory(this.pc),this.setRegister("pc",this.pc+1)}decode(t){for(var e={raw:t,strictValid:!0},r=Array(16),o=0;o<r.length;o++)r[o]=t>>o&1;e.opcode=t>>12&15;var l=t&63,h=t>>6&7,y=t&511,C=t>>9&7,F=t&2047;switch(e.opcode){case 1:case 5:e.opname=e.opcode===1?"ADD":"AND",e.dr=C,e.sr1=h,e.mode="none",r[5]===0?(e.arithmeticMode="reg",e.sr2=t&7,(r[4]!==0||r[3]!==0)&&(e.strictValid=!1)):(e.arithmeticMode="imm",e.imm=LC3Util.signExtend16(t&31,5));break;case 0:e.opname="BR",e.n=r[11]==1,e.z=r[10]==1,e.p=r[9]==1,e.mode="pcOffset",e.offset=LC3Util.signExtend16(y,9);break;case 12:e.opname=h===7?"RET":"JMP",e.mode="baseOffset",e.baseR=h,e.offset=0,(C!==0||l!==0)&&(e.strictValid=!1);break;case 4:r[11]===0?(e.opname="JSRR",e.mode="baseOffset",e.baseR=h,e.offset=0,(C!==0||l!==0)&&(e.strictValid=!1)):(e.opname="JSR",e.mode="pcOffset",e.offset=LC3Util.signExtend16(F,11));break;case 2:case 10:e.opname=e.opcode===2?"LD":"LDI",e.dr=C,e.mode="pcOffset",e.offset=LC3Util.signExtend16(y,9);break;case 6:e.opname="LDR",e.dr=C,e.mode="baseOffset",e.baseR=h,e.offset=LC3Util.signExtend16(l,6);break;case 14:e.opname="LEA",e.dr=C,e.mode="pcOffset",e.offset=LC3Util.signExtend16(y,9);break;case 9:e.opname="NOT",e.mode="none",e.dr=C,e.sr=h,l!==63&&(e.strictValid=!1);break;case 8:e.opname="RTI",e.mode="none",t&!0&&(e.strictValid=!1);break;case 3:case 11:e.opname=e.opcode===3?"ST":"STI",e.sr=C,e.mode="pcOffset",e.offset=LC3Util.signExtend16(y,9);break;case 7:e.opname="STR",e.sr=C,e.mode="baseOffset",e.baseR=h,e.offset=LC3Util.signExtend16(l,6);break;case 15:e.opname="TRAP",e.mode="trap",e.trapVector=t&255,(t&3840)!==0&&(e.strictValid=!1);break;default:e.opname="reserved",e.strictValid=!1;break}return e}evaluateAddress(t,e){return e.mode==="none"?null:e.mode==="pcOffset"?LC3Util.toUint16(t+e.offset):e.mode==="baseOffset"?LC3Util.toUint16(this.getRegister(e.baseR)+e.offset):e.mode==="trap"?e.trapVector:void 0}fetchOperands(t){return t==null?t:this.readMemory(t)}execute(t,e,r){switch(t.isIO=!1,t.opcode){case 1:case 5:var o=this.getRegister(t.sr1),l=t.arithmeticMode==="reg"?this.getRegister(t.sr2):t.imm;return t.opcode===1?o+l:o&l;case 0:var h=this.getConditionCode(),y=t.n&&h<0||t.z&&h===0||t.p&&h>0;return y&&this.setRegister("pc",e),null;case 12:return this.setRegister("pc",e),t.opname==="RET"&&this.subroutineLevel--,null;case 4:return this.setRegister(7,this.pc),this.setRegister("pc",e),this.subroutineLevel++,null;case 2:return this.ioLocations.indexOf(e)!==-1&&(t.isIO=!0),r;case 10:return this.ioLocations.indexOf(r)!==-1&&(t.isIO=!0),this.readMemory(r);case 6:return this.ioLocations.indexOf(e)!==-1&&(t.isIO=!0),r;case 14:return e;case 9:return LC3Util.toUint16(~this.getRegister(t.sr));case 8:if((this.psr&32768)!==0){var F={type:"exception",exception:"privilege"};this.notifyListeners(F),this.halt()}else{var C=this.r[6];this.setRegister("pc",this.readMemory(C)),this.setRegister("psr",this.readMemory(C+1)),this.setRegister(6,C+2)}return null;case 3:return this.ioLocations.indexOf(e)!==-1&&(t.isIO=!0),this.writeMemory(e,this.getRegister(t.sr)),null;case 11:return this.ioLocations.indexOf(r)!==-1&&(t.isIO=!0),this.writeMemory(r,this.getRegister(t.sr)),null;case 7:return this.ioLocations.indexOf(e)!==-1&&(t.isIO=!0),this.writeMemory(e,this.getRegister(t.sr)),null;case 15:return this.setRegister(7,this.pc),this.setRegister("pc",r),this.subroutineLevel++,null;case 13:var F={type:"exception",exception:"opcode"};return this.notifyListeners(F),this.halt(),null;default:return}}storeResult(t,e){switch(t.opcode){case 1:case 5:case 9:this.setRegister(t.dr,e),this.setConditionCode(e);break;case 0:case 12:case 4:return;case 2:case 10:case 6:case 14:this.setRegister(t.dr,e),this.setConditionCode(e);break;case 8:return;case 3:case 11:case 7:return}}instructionToString(t,e){var r=this.decode(e);if(!r.strictValid)return".FILL "+LC3Util.toHexString(r.raw);var o=function(V){return"R"+V};if(!r.strictValid)return".FILL "+LC3Util.toHexString(r.raw);var l=r.opname+" ",h=t+1,y=this.evaluateAddress(h,r);switch(r.opcode){case 1:case 5:var C=o(r.sr1),F=r.arithmeticMode=="reg"?o(r.sr2):"#"+r.imm,b=o(r.dr);return l+[b,C,F].join(", ");case 9:return l+[o(r.dr),o(r.sr)].join(", ");case 0:if((r.raw&3584)===0||r.offset===0)return"NOP";var B="BR";return r.n&&(B+="n"),r.z&&(B+="z"),r.p&&(B+="p"),B+" "+this.formatAddress(y);case 12:var _=r.baseR;return _===7?"RET":"JMP "+o(_);case 4:return r.mode==="pcOffset"?l+this.formatAddress(y):l+o(r.baseR);case 2:case 10:case 14:return l+[o(r.dr),this.formatAddress(y)].join(", ");case 6:return l+[o(r.dr),o(r.baseR),"#"+r.offset].join(", ");case 8:return r.opname;case 3:case 11:return l+[o(r.sr),this.formatAddress(y)].join(", ");case 7:return l+[o(r.sr),o(r.baseR),"#"+r.offset].join(", ");case 15:var g=this.namedTrapVectors[y];return g!==void 0?g:l+LC3Util.toHexString(y,2);default:return null}}instructionAddressToString(t){return this.instructionToString(t,this.getMemory(t))}setLabel(t,e){this.unsetLabelGivenAddress(t),this.unsetLabelGivenName(e),this.labelToAddress[e]=t,this.addressToLabel[t]=e;var r={type:"labelset",address:t,label:e};this.notifyListeners(r)}unsetLabelGivenAddress(t){var e=this.addressToLabel[t],r=e!==void 0;return r?(this.unsetLabel_internal_(t,e),!0):!1}unsetLabelGivenName(t){var e=this.labelToAddress[t],r=e!==void 0;return r?(this.unsetLabel_internal_(e,t),!0):!1}unsetLabel_internal_(t,e){delete this.addressToLabel[t],delete this.labelToAddress[e];var r={type:"labelunset",address:t,label:e};this.notifyListeners(r)}getMemory(t){return this.memory[t]}setMemory(t,e){var r={type:"memset",address:t,newValue:e};this.memory[t]=LC3Util.toUint16(e),this.notifyListeners(r)}readMemory(t){return t===this.kbdr&&this.setMemory(this.kbsr,this.getMemory(this.kbsr)&32767),this.getMemory(t)}writeMemory(t,e){t===this.ddr&&this.setMemory(this.dsr,this.getMemory(this.dsr)&32767),this.setMemory(t,e)}getRegister(t){if(!isNaN(t)&&t>=0&&t<this.r.length)return this.r[t];for(var e=0;e<this.specialRegisters.length;e++){var r=this.specialRegisters[e];if(r===t)return this[r]}}setRegister(t,e){e=LC3Util.toUint16(e);var r={type:"regset",register:void 0,newValue:e};if(!isNaN(t)&&t>=0&&t<this.r.length)return r.register=t,this.r[t]=e,this.notifyListeners(r),!0;for(var o=0;o<this.specialRegisters.length;o++){var l=this.specialRegisters[o];if(l===t)return r.register=l,this[l]=e,this.notifyListeners(r),!0}return!1}resetNumericRegisters(){for(var t=0;t<this.r.length;t++)this.r[t]=0}resetAllRegisters(){this.resetNumericRegisters(),this.pc=12288,this.ir=0,this.psr=32770}formatConditionCode(){var t=this.getConditionCode();return t===void 0?"Invalid":t>0?"P":t<0?"N":"Z"}sendKey(t){this.bufferedKeys.enqueue(t),this.notifyListeners({type:"bufferchange"})}clearBufferedKeys(){this.bufferedKeys=new Queue,this.notifyListeners({type:"bufferchange"})}isRunning(){return(this.getMemory(this.mcr)&32768)!==0}halt(){this.setMemory(this.mcr,this.getMemory(this.mcr)&32767)}unhalt(){this.setMemory(this.mcr,this.getMemory(this.mcr)|32768)}loadAssembled(t){if(t.error)return!1;for(var e=t.orig,r=t.machineCode,o=t.symbolTable||{},l=0;l<r.length;l++)this.setMemory(e+l,r[l]);for(var h in o)this.setLabel(o[h],h);this.setRegister("pc",e)}interrupt(t,e){if(!(t<=(this.psr&1792)>>8)){var r=this.getRegister(6);r--,this.setMemory(r,this.psr),r--,this.setMemory(r,this.pc),this.psr&=30968,this.psr|=(t&7)<<8,this.setRegister("pc",e),this.setRegister(6,r)}}}const logs=[];class caseResult{constructor(t,e,r,o,l){Z(this,"testcase");Z(this,"expectedResult");Z(this,"state");Z(this,"instructions");Z(this,"yourResult");this.testcase=t,this.expectedResult=e,this.state=r,this.instructions=o,this.yourResult=l}}function caseTest(a,t,e){a.pc=12288,a.psr=32770,a.totalInstruction=0;for(let r=0;r<=t;r++){let o;const l=a.decode(a.getMemory(a.pc));if(e){const h=a.instructionAddressToString(a.pc);logs.push(`\u6267\u884C x${a.pc.toString(16)}\uFF1A${h}`),o=Array.from(a.r)}if(l.raw>=61440&&l.raw<=61695||l.raw===0)return!0;a.nextInstruction(),e&&a.r.forEach((h,y)=>{if(h!==o[y]){const C=logs.pop();logs.push(C+`\uFF0CR${y} \u7531 ${o[y]} \u53D8\u4E3A ${h}`)}})}return!1}function lc3bench(code,testCode,ansCode,testcases,instrLimit,log){const ans=[""],lc3=new core,asResult=as(code),hexbinResult=hexbin(code);if(!("error"in asResult))lc3.loadAssembled(asResult),ans.push("(\u4F5C\u4E3A\u6C47\u7F16\u4EE3\u7801\u5904\u7406)");else{if("error"in hexbinResult)return["\u4EE3\u7801\u65E0\u6CD5\u88AB\u8BC6\u522B\u4E3A\u6B63\u786E\u7684\u673A\u5668\u7801\u6216\u8005\u6C47\u7F16\u4EE3\u7801..."];if(hexbinResult.orig!=12288){const a=hexbin(`0011000000000000
`+code);lc3.loadAssembled(a)}else lc3.loadAssembled(hexbinResult);ans.push("(\u4F5C\u4E3A\u673A\u5668\u7801\u5904\u7406)")}let expectedResult,yourResult;try{eval(`expectedResult = ${testCode}`)}catch{return["\u8BC4\u6D4B\u51FD\u6570\u7F16\u5199\u51FA\u73B0\u8BED\u6CD5\u9519\u8BEF..."]}try{eval(`yourResult = ${ansCode}`)}catch{return["\u83B7\u53D6\u7B54\u6848\u51FD\u6570\u7F16\u5199\u51FA\u73B0\u8BED\u6CD5\u9519\u8BEF..."]}log&&(testcases=[testcases[0]],logs.splice(0));const caseResults=testcases.map(a=>new caseResult(a,expectedResult(a),caseTest(lc3,instrLimit,log),lc3.totalInstruction,yourResult()));let totalInstructions=0,passCases=0;caseResults.forEach(a=>{totalInstructions+=a.instructions,a.state==!1?ans.push(`\u5F02\u5E38\u6837\u4F8B: ${a.testcase} \u8D85\u51FA\u6700\u5927\u6267\u884C\u6307\u4EE4\u6570\uFF0C\u53EF\u4EE5\u5C1D\u8BD5\u8C03\u6574\u8BBE\u7F6E\uFF0C\u6216\u8005\u53EF\u80FD\u53D1\u751F\u4E86\u6B7B\u5FAA\u73AF`):a.expectedResult==a.yourResult?(passCases++,ans.push(`\u901A\u8FC7\u6837\u4F8B: ${a.testcase}. \u6307\u4EE4\u6570: ${a.instructions}, \u9884\u671F\u7ED3\u679C: ${a.expectedResult}, \u4F60\u7684\u8F93\u51FA: ${a.yourResult}`)):ans.push(`\u5931\u8D25\u6837\u4F8B: ${a.testcase}. \u6307\u4EE4\u6570: ${a.instructions}, \u9884\u671F\u7ED3\u679C: ${a.expectedResult}, \u4F60\u7684\u8F93\u51FA: ${a.yourResult}`)});const totalCases=caseResults.length;return ans.push(`\u5E73\u5747\u6307\u4EE4\u6570: ${totalInstructions/totalCases}`),ans[0]=`\u901A\u8FC7: ${passCases} / ${totalCases}`,log&&ans.push(...logs),ans}const _hoisted_1$1={class:"card"},_hoisted_2={class:"form-item"},_hoisted_3=createBaseVNode("span",{class:"label"},"\u5355\u6837\u4F8B\u6700\u5927\u6307\u4EE4\u6570",-1),_hoisted_4={class:"form-item"},_hoisted_5=createBaseVNode("span",{class:"label"},"\u9009\u62E9\u8BC4\u6D4B\u5B9E\u9A8C",-1),_hoisted_6={style:{display:"flex"}},_hoisted_7=["id","value"],_hoisted_8=["for"],_hoisted_9={class:"card",style:{"margin-bottom":"2em"}},_hoisted_10=createBaseVNode("span",{class:"label"},"\u5B9E\u9A8C\u8981\u6C42",-1),_hoisted_11={class:"form-item"},_hoisted_12=createBaseVNode("span",{class:"label"},"\u6D4B\u8BD5\u6837\u4F8B\uFF0C\u6837\u4F8B\u4E4B\u95F4\u4EE5\u82F1\u6587\u9017\u53F7\u5206\u5272",-1),_hoisted_13={class:"form-item"},_hoisted_14=createBaseVNode("span",{class:"label"},"\u4EE3\u7801\u6587\u672C",-1),_hoisted_15={class:"form-item"},_hoisted_16=createBaseVNode("span",{class:"label"},"\u8BC4\u6D4B\u51FD\u6570",-1),_hoisted_17={class:"form-item"},_hoisted_18=createBaseVNode("span",{class:"label"},"\u7B54\u6848\u51FD\u6570",-1),_hoisted_19={class:"form-item"},_hoisted_20=createBaseVNode("span",{class:"label"},"\u542F\u7528\u8C03\u8BD5\u6A21\u5F0F\uFF08\u652F\u6301\u8FFD\u8E2A pc \u548C\u5BC4\u5B58\u5668\u53D8\u5316\uFF09",-1),_hoisted_21={style:{display:"flex","justify-content":"flex-end"}},_hoisted_22=createTextVNode(" \u8BC4\u6D4B "),_hoisted_23={key:0,class:"card",style:{"margin-top":"2em"}},_hoisted_24=createBaseVNode("span",{class:"label"},"\u8BC4\u6D4B\u7ED3\u679C",-1),_sfc_main$1=defineComponent({__name:"Judge",setup(a){const t=ref(1e5),e=ref("\u81EA\u5B9A\u4E49"),r=ref(getPreset(e.value)),o=ref(""),l=ref(!1),h=ref([]),y=computed(()=>r.value.testCases.split(",").map(F=>F.trim()).filter(Boolean));watch(e,F=>{r.value=getPreset(F),h.value=[]}),watch(l,F=>{F&&window.alert("\u5F00\u542F\u8C03\u8BD5\u6A21\u5F0F\u540E\uFF0C\u5C06\u53EA\u663E\u793A\u7B2C\u4E00\u4E2A\u6D4B\u8BD5\u6837\u4F8B\u7684\u5B8C\u6574\u6267\u884C\u8FC7\u7A0B\uFF0C\u5176\u4F59\u6837\u4F8B\u4F1A\u88AB\u5FFD\u7565...")});const C=async()=>{h.value=[],o.value||h.value.push("\u6CA1\u6709\u586B\u5199\u5F85\u8BC4\u6D4B\u4EE3\u7801\uFF0C\u65E0\u6CD5\u8BC4\u6D4B..."),r.value.testCode||h.value.push("\u6CA1\u6709\u8BC4\u6D4B\u51FD\u6570\uFF0C\u65E0\u6CD5\u8BC4\u6D4B..."),r.value.ansCode||h.value.push("\u6CA1\u6709\u7B54\u6848\u51FD\u6570\uFF0C\u65E0\u6CD5\u8BC4\u6D4B..."),y.value.length||h.value.push("\u6CA1\u6709\u6D4B\u8BD5\u6837\u4F8B\uFF0C\u65E0\u6CD5\u8BC4\u6D4B..."),h.value.length||(h.value=lc3bench(o.value,r.value.testCode,r.value.ansCode,y.value,t.value,l.value)),await nextTick(),window.scrollTo(0,document.documentElement.scrollHeight)};return(F,b)=>{const B=resolveComponent("f-switch"),_=resolveComponent("f-button");return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2,[_hoisted_3,withDirectives(createBaseVNode("input",{type:"number",style:{border:"0.5px solid",padding:"0.5em",margin:"4px"},"onUpdate:modelValue":b[0]||(b[0]=g=>t.value=g)},null,512),[[vModelText,t.value]])]),createBaseVNode("div",_hoisted_4,[_hoisted_5,createBaseVNode("div",_hoisted_6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(presets),g=>(openBlock(),createElementBlock("div",{key:g,style:{margin:"4px"}},[withDirectives(createBaseVNode("input",{type:"radio",id:g,value:g,"onUpdate:modelValue":b[1]||(b[1]=V=>e.value=V)},null,8,_hoisted_7),[[vModelRadio,e.value]]),createBaseVNode("label",{for:g},toDisplayString(g),9,_hoisted_8)]))),128))])]),createBaseVNode("div",_hoisted_9,[_hoisted_10,createBaseVNode("div",null,toDisplayString(r.value.description),1)]),createBaseVNode("div",_hoisted_11,[_hoisted_12,withDirectives(createBaseVNode("input",{style:{border:"0.5px solid",padding:"0.5em",margin:"4px","box-sizing":"border-box",width:"100%"},"onUpdate:modelValue":b[2]||(b[2]=g=>r.value.testCases=g)},null,512),[[vModelText,r.value.testCases]])]),createBaseVNode("div",_hoisted_13,[_hoisted_14,withDirectives(createBaseVNode("textarea",{rows:"10",placeholder:"\u5728\u6B64\u8F93\u5165\u5F85\u8BC4\u6D4B\u7684\u6C47\u7F16\u4EE3\u7801\u6216\u8005\u673A\u5668\u7801",style:{border:"0.5px solid",margin:"4px"},"onUpdate:modelValue":b[3]||(b[3]=g=>o.value=g)},null,512),[[vModelText,o.value]])]),withDirectives(createBaseVNode("div",_hoisted_15,[_hoisted_16,withDirectives(createBaseVNode("textarea",{rows:"10",placeholder:"\u4E00\u4E2A js \u51FD\u6570\uFF0C\u63A5\u53D7\u5355\u4E2A\u6837\u4F8B\uFF08\u5B57\u7B26\u4E32\uFF09\u4F5C\u4E3A\u53C2\u6570\uFF0C\u521D\u59CB\u5316 lc3.r \u548C lc3.memory\uFF08\u5BC4\u5B58\u5668\u6570\u7EC4\u548C\u5185\u5B58\u6570\u7EC4\uFF09\uFF0C\u5E76\u8FD4\u56DE\u5BF9\u4E8E\u6BCF\u4E2A\u6837\u4F8B\u800C\u8A00\u9884\u671F\u7684\u8F93\u51FA",style:{border:"0.5px solid",margin:"4px"},"onUpdate:modelValue":b[4]||(b[4]=g=>r.value.testCode=g)},null,512),[[vModelText,r.value.testCode]])],512),[[vShow,e.value==="\u81EA\u5B9A\u4E49"]]),withDirectives(createBaseVNode("div",_hoisted_17,[_hoisted_18,withDirectives(createBaseVNode("textarea",{rows:"10",placeholder:"\u4E00\u4E2A js \u51FD\u6570\uFF0C\u8FD4\u56DE\u6D4B\u8BD5\u7ED3\u675F\u540E\u8BFB\u53D6 lc3 \u6A21\u62DF\u5668\u7684\u54EA\u4E2A\u53D8\u91CF\uFF08\u5982 lc3.r \u548C lc3.memory \u6570\u7EC4\u4E2D\u7684\u67D0\u4E00\u9879\uFF09\u7684\u503C\u4F5C\u4E3A\u7528\u6237\u7A0B\u5E8F\u8FD0\u884C\u7684\u8F93\u51FA\uFF08\u5373\u8BC4\u6D4B\u4F9D\u636E\uFF09",style:{border:"0.5px solid",margin:"4px"},"onUpdate:modelValue":b[5]||(b[5]=g=>r.value.ansCode=g)},null,512),[[vModelText,r.value.ansCode]])],512),[[vShow,e.value==="\u81EA\u5B9A\u4E49"]]),createBaseVNode("div",_hoisted_19,[_hoisted_20,createVNode(B,{modelValue:l.value,"onUpdate:modelValue":b[6]||(b[6]=g=>l.value=g)},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_21,[createVNode(_,{type:"primary",onClick:b[7]||(b[7]=g=>C())},{default:withCtx(()=>[_hoisted_22]),_:1})]),h.value.length?(openBlock(),createElementBlock("div",_hoisted_23,[_hoisted_24,createBaseVNode("ul",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(h.value,g=>(openBlock(),createElementBlock("li",{key:g},toDisplayString(g),1))),128))])])):createCommentVNode("",!0)])}}}),Judge_vue_vue_type_style_index_0_lang="",_hoisted_1=createStaticVNode("",14),__pageData=JSON.parse('{"title":"lc3 \u6A21\u62DF\u8BC4\u6D4B","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u8BF4\u660E","slug":"\u8BF4\u660E"},{"level":2,"title":"\u81EA\u5B9A\u4E49\u8BC4\u6D4B\u529F\u80FD\u8BF4\u660E","slug":"\u81EA\u5B9A\u4E49\u8BC4\u6D4B\u529F\u80FD\u8BF4\u660E"},{"level":2,"title":"\u8BC4\u6D4B","slug":"\u8BC4\u6D4B"}],"relativePath":"judge.md"}'),__default__={name:"judge.md"},_sfc_main=Object.assign(__default__,{setup(a){return(t,e)=>(openBlock(),createElementBlock("div",null,[_hoisted_1,createVNode(_sfc_main$1)]))}});export{__pageData,_sfc_main as default};
